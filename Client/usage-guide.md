# מדריך שימוש - מערכת צ'אט Firebase

## 🚀 איך להתחיל?

### 1. הגדרת Firebase

1. עקוב אחר ההוראות ב-`firebase-setup-instructions.md`
2. עדכן את הקובץ `js/firebase-config.js` עם הפרטים שלך
3. הפעל את האתר על שרת HTTP (לא file://)

### 2. שימוש במערכת

- **פתיחת הצ'אט**: היכנס לדף `chat.html`
- **בחירת שיחה**: לחץ על עיגול המשתמש או על "צ'אט קבוצתי"
- **שליחת הודעה**: הקלד ולחץ Enter או "שלח"
- **צפייה בהודעות**: ההודעות מתעדכנות אוטומטית בזמן אמת

## 💬 סוגי צ'אט

### צ'אט קבוצתי

- כל חברי הפרויקט יכולים לראות
- הודעות נשמרות עם `receiverUserID: null`
- מתאים לעדכונים כלליים

### צ'אט פרטי

- רק בין שני משתמשים
- הודעות נשמרות עם `receiverUserID` ספציפי
- מתאים לשיחות אישיות

## 🔔 התראות

### נקודות לא נקראות

- **נקודה כחולה** = יש הודעות חדשות
- **ללא נקודה** = אין הודעות חדשות או שאתה בצ'אט הזה
- מתעדכנות כל 30 שניות

### איך זה עובד?

- המערכת בודקת הודעות מ-5 הדקות האחרונות
- אם יש הודעות חדשות מאחרים - מופיעה נקודה
- ברגע שנכנסים לצ'אט - הנקודה נעלמת

## 🛠️ תכונות מתקדמות

### זמן אמת

- ההודעות מתעדכנות מיד ללא רענון הדף
- אם מישהו שולח הודעה - תראה אותה תוך שנייה
- המערכת משתמשת ב-`onSnapshot` של Firebase

### הגנה מפני כפילויות

- ההודעות לא מתווספות פעמיים
- כשמחליפים צ'אט - המסכים מתנקה לחלוטין
- שימוש חכם ב-`docChanges()` להודעות חדשות

### ביצועים משופרים

- רק הודעות חדשות נטענות (לא הכל מחדש)
- שאילתות מקוממות לפי פרויקט ומשתמש
- עיכוב קטן בטעינה למניעת race conditions

## 🔧 התאמה אישית

### שינוי זמני הבדיקה

```javascript
// במקום 5 דקות, אפשר 10 דקות
const tenMinutesAgo = Timestamp.fromDate(new Date(Date.now() - 10 * 60 * 1000));
```

### שינוי תדירות העדכונים

```javascript
// במקום 30 שניות, אפשר דקה
setInterval(updateUnreadBadges, 60000);
```

### הוספת הגבלת הודעות

```javascript
// הוסף .limit(50) לשאילתות
const messagesQuery = query(
  collection(db, "messages"),
  where("projectID", "==", projectID),
  orderBy("sentAt", "asc"),
  limit(50) // רק 50 הודעות אחרונות
);
```

## 🐛 פתרון בעיות נפוצות

### ההודעות לא מתעדכנות

1. בדוק את הקונסול - יש שגיאות?
2. ודא שחוקי Firebase מאפשרים קריאה/כתיבה
3. בדוק שהאתר רץ על HTTP ולא FILE

### ההודעות מופיעות פעמיים

1. אל תרענן את הדף בזמן שליחה
2. וודא שאין שני listeners פעילים
3. בדוק ש-`messagesListener` מתנקה כהלכה

### הנקודות לא מתעדכנות

1. בדוק שהזמנים ב-Firestore נכונים
2. ודא שה-`userID` תואם למה ששמור ב-localStorage
3. בדוק שחוקי Firebase מאפשרים שאילתות על השדות

## 📱 תאימות דפדפנים

### נתמך:

- Chrome 89+
- Firefox 90+
- Safari 14+
- Edge 89+

### לא נתמך:

- Internet Explorer (כל הגרסאות)
- דפדפנים ישנים ללא תמיכה ב-ES6 modules

---

**בהצלחה עם המערכת! 🎊**
